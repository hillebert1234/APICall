@page "/fuel-overview"
@using APICall.Components.Models
@inject APIService APIService

<h1>FuelOverview</h1>

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <p class="text-danger">@ErrorMessage</p>
}
else if (dieselData == null || gasData == null)
{
    <p>Loading fuel data...</p>
}
else
{
    <div style="display: flex; gap: 20px;">
        <div style="flex: 1; border: 1px solid #ccc; border-radius: 8px; padding: 15px; max-height: 350px; overflow-y: auto; background-color: #f9f9f9;">
            <h3 style="margin-bottom: 10px;">Diesel</h3>
            <p><strong>Billigst:</strong> @MinDieselPrice per gallon (@MinDieselDate)</p>
            <p><strong>Dyrest:</strong> @MaxDieselPrice per gallon (@MaxDieselDate)</p>
            <ul style="list-style: none; padding: 0;">
                @foreach (var diesel in dieselData)
                {
                    <li style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee;">
                        <span>@diesel.Date?.ToString("dd-MM-yyyy")</span>
                        <span>@diesel.PriceValue per gallon</span>
                    </li>
                }
            </ul>
        </div>

        <div style="flex: 1; border: 1px solid #ccc; border-radius: 8px; padding: 15px; max-height: 350px; overflow-y: auto; background-color: #f9f9f9;">
            <h3 style="margin-bottom: 10px;">Gas</h3>
            <p><strong>Billigst:</strong> @MinGasPrice per gallon (@MinGasDate)</p>
            <p><strong>Dyrest:</strong> @MaxGasPrice per gallon (@MaxGasDate)</p>
            <ul style="list-style: none; padding: 0;">
                @foreach (var gas in gasData)
                {
                    <li style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee;">
                        <span>@gas.Date?.ToString("dd-MM-yyyy")</span>
                        <span>@gas.PriceValue per gallon</span>
                    </li>
                }
            </ul>
        </div>
    </div>
}
@code {
    private List<Diesel>? dieselData;
    private List<Gas>? gasData;
    private string? ErrorMessage;

    private decimal MinDieselPrice => dieselData!.Min(d => d.PriceValue ?? decimal.MaxValue);
    private decimal MaxDieselPrice => dieselData!.Max(d => d.PriceValue ?? decimal.MinValue);
    private string? MinDieselDate => dieselData!.OrderBy(d => d.PriceValue ?? decimal.MaxValue).FirstOrDefault()?.Date?.ToString("dd-MM-yyyy");
    private string? MaxDieselDate => dieselData!.OrderByDescending(d => d.PriceValue ?? decimal.MinValue).FirstOrDefault()?.Date?.ToString("dd-MM-yyyy");

    private decimal MinGasPrice => gasData!.Min(g => g.PriceValue ?? decimal.MaxValue);
    private decimal MaxGasPrice => gasData!.Max(g => g.PriceValue ?? decimal.MinValue);
    private string? MinGasDate => gasData!.OrderBy(g => g.PriceValue ?? decimal.MaxValue).FirstOrDefault()?.Date?.ToString("dd-MM-yyyy");
    private string? MaxGasDate => gasData!.OrderByDescending(g => g.PriceValue ?? decimal.MinValue).FirstOrDefault()?.Date?.ToString("dd-MM-yyyy");

    protected override async Task OnInitializedAsync()
    {
        dieselData = await APIService.GetDieselDataAsync();
        if (dieselData == null)
        {
            ErrorMessage = "Failed to load diesel data.";
            return;
        }

        gasData = await APIService.GetGasDataAsync();
        if (gasData == null)
        {
            ErrorMessage = "Failed to load gas data.";
            return;
        }
    }
}